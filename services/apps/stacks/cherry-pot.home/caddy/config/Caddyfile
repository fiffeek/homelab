{
	servers {
		client_ip_headers X-Forwarded-For X-Real-IP

		trusted_proxies static private_ranges
		trusted_proxies_strict
	}
}

vpn.filipmikina.com {
        reverse_proxy wg-easy:51821
        tls internal
}

pihole.home.filipmikina.com {
        reverse_proxy pihole.vpn.filipmikina.com:8080
        tls internal
}

secrets.home.filipmikina.com {
        reverse_proxy black-cat:10080
        tls internal
}

grafana.home.filipmikina.com {
        reverse_proxy black-cat:13000
        tls internal
}


prometheus.home.filipmikina.com {
        reverse_proxy black-cat:19090
        tls internal
}

alerts.home.filipmikina.com {
        reverse_proxy black-cat:19093
        tls internal
}

search.home.filipmikina.com {
        tls internal
        encode zstd gzip

        @api {
          path /config
          path /healthz
          path /stats/errors
          path /stats/checker
        }

        @static {
          path /static/*
        }

        @imageproxy {
          path /image_proxy
        }

        header {
          # CSP (https://content-security-policy.com)
          Content-Security-Policy "upgrade-insecure-requests; default-src 'none'; script-src 'self'; style-src 'self' 'unsafe-inline'; form-action 'self' https:; font-src 'self'; frame-ancestors 'self'; base-uri 'self'; connect-src 'self'; img-src * data:; frame-src https:;"

          # Disable browser features
          Permissions-Policy "accelerometer=(),camera=(),geolocation=(),gyroscope=(),magnetometer=(),microphone=(),payment=(),usb=()"

          # Only allow same-origin requests
          Referrer-Policy "same-origin"

          # Prevent MIME type sniffing from the declared Content-Type
          X-Content-Type-Options "nosniff"

          # Comment header to allow indexing by search engines
          X-Robots-Tag "noindex, nofollow, noarchive, nositelinkssearchbox, nosnippet, notranslate, noimageindex"

          # Remove "Server" header
          -Server
        }

        header @api {
          Access-Control-Allow-Methods "GET, OPTIONS"
          Access-Control-Allow-Origin "*"
        }

        route {
          # Cache policy
          header Cache-Control "no-cache"
          header @static Cache-Control "public, max-age=30, stale-while-revalidate=60"
          header @imageproxy Cache-Control "public, max-age=3600"
        }

        reverse_proxy black-cat:18088
}
